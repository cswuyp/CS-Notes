* [一、索引](#一索引)
    * [B+ Tree 原理](#b-tree-原理)
    * [MySQL 索引](#mysql-索引)
    * [索引优化](#索引优化)
    * [索引的优点](#索引的优点)
    * [索引的使用条件](#索引的使用条件)



* [MySQL为什么要用B+树来存储索引而不用hash或者红黑树](#mysql为什么要用b树来存储索引而不用hash或者红黑树)
* [MYSQL的两种存储引擎区别（事务、锁级别等等），各自的适用场景](#mysql的两种存储引擎区别事务锁级别等等各自的适用场景)
* [InnoDB索引和MyISAM索引的区别](#innodb索引和myisam索引的区别)
* [索引有B+索引和hash索引，各自的区别](#索引有b索引和hash索引各自的区别 )
* [B+索引数据结构，和B树的区别](#b索引数据结构和b树的区别)
* [聚集索引和非聚集索引](#聚集索引和非聚集索引的区别)
* [索引的优缺点，什么时候使用索引，什么时候不能使用索引](#索引的优缺点什么时候使用索引什么时候不能使用索引)


# 一、索引
## B+ Tree 原理
B Tree指的是Balance Tree，就是平衡树。平衡树是一棵查找树，并且所有叶子节点位于同一层。  
B+ Tree是基于B Tree和叶子节点顺序访问指针进行实现，它具有B Tree的平衡性，并且通过顺序访问指针来提高区间查询的性能。  
在B+ Tree中，一个节点中的Key从左到右非递减排列，如果某个指针的左右相邻Key分别是Key<sub>i</sub>和Key<sub>i+1</sub>,且不为null，则该指针指向节点的所有Key大于等于Key<sub>i</sub>且小于小于等于Keysub>i+1</sub>。
<div align="center"> <img src="./B+树.jpg" width="600"/> </div><br>
进行查找操作时，首先在根节点进行二分查找，找打一个Key所在的指针，然后递归地在指针所指向的节点进行查找。直到查找到叶子节点，然后在叶子节点上进行二分查找，找到Key所对应的data。

插入删除操作会破坏平衡树的平衡性，因此在插入删除操作之后，需要对树进行一个分裂、合并、旋转等操作来维护平衡性。

# MySQL 索引
索引是在存储引擎层实现的，而不是在服务器层实现的，所以不同的存储引擎具有不同的索引类型和实现。

（1）B+ Tree索引  
是大多数MySQL存储引擎的默认索引类型。  

因为不再需要进行全表扫描，只需要对树进行搜索即可，所以查找速度快很多。

除了用于查找，还可以用于排序和分组。  

可以指定多个序列作为索引列，多个索引列共同组成键。

适用于全键值、键值范围和键前缀查找，其中键前缀查找只适用于最前缀查找。如果不是按照索引列的顺序进行查找，则无法使用索引。

InnoDB的B+Tree索引分为索引和辅助索引。主索引的叶子节点data域记录着完整的数据记录，这种索引方式被称为聚簇索引。因为无法把数据行存放在两个不同的地方，所以一个表只能有一个聚簇索引。
<div align="center"> <img src="./索引1.png" width="600"/> </div><br>
辅助索引的叶子节点的data域记录着主键的值，因此在使用辅助索引进行查找时，需要先查找到主键值，然后再到主索引中进行查找。
<div align="center"> <img src="./索引2.jpg" width="600"/> </div><br>
（2）哈希索引
哈希索引能以O(1)时间进行查找，但是失去了有序性：  
无法用于排序与分组。  
只支持精确查找，无法用于部分查找和范围查找。

InnoDB存储引擎有一个特殊的功能叫“自适应哈希索引”，当某个索引值被使用的非常频繁时，会在B+Tree索引上再创建一个哈希索引，这样就让B+Tree索引具有哈希索引的一些优点，比如快速的哈希查找。

（3）MyISAM 存储引擎支持全文索引，用于查找文本中的关键词，而不是直接比较是否相等。

查找条件使用 MATCH AGAINST，而不是普通的 WHERE。

全文索引使用倒排索引实现，它记录着关键词到其所在文档的映射。

InnoDB 存储引擎在 MySQL 5.6.4 版本中也开始支持全文索引。

（4）MyISAM 存储引擎支持空间数据索引（R-Tree），可以用于地理数据存储。空间数据索引会从所有维度来索引数据，可以有效地使用任意维度来进行组合查询。

必须使用 GIS 相关的函数来维护数据。

# 索引优化


# 索引的使用条件
大大减少了服务器需要扫描的数据行数。

帮助服务器避免进行排序和分组，以及避免创建临时表（B+Tree 索引是有序的，可以用于 ORDER BY 和 GROUP BY 操作。临时表主要是在排序和分组过程中创建，因为不需要排序和分组，也就不需要创建临时表）。

将随机 I/O 变为顺序 I/O（B+Tree 索引是有序的，会将相邻的数据都存储在一起）。

# 索引的优点
对于非常小的表、大部分情况下简单的全表扫描比建立索引更高效；

对于中到大型的表，索引就非常有效；

但是对于特大型的表，建立和维护索引的代价将会随之增长。这种情况下，需要用到一种技术可以直接区分出需要查询的一组数据，而不是一条记录一条记录地匹配，例如可以使用分区技术。

# MySQL为什么要用B+树来存储索引而不用hash或者红黑树

（1）减少查找次数  

平衡树查找操作的时间复杂度和树高 h 相关，O(h)=O(logdN)，其中 d 为每个节点的出度。  
红黑树的出度为 2，而 B+ Tree 的出度一般都非常大，所以红黑树的树高 h 很明显比 B+ Tree 大非常多，查找的次数也就更多。  
（2）利用磁盘预读特性

为了减少磁盘 I/O 操作，磁盘往往不是严格按需读取，而是每次都会预读。预读过程中，磁盘进行顺序读取，顺序读取不需要进行磁盘寻道，并且只需要很短的旋转时间，速度会非常快。  
操作系统一般将内存和磁盘分割成固定大小的块，每一块称为一页，内存与磁盘以页为单位交换数据。数据库系统将索引的一个节点的大小设置为页的大小，使得一次 I/O 就能完全载入一个节点。并且可以利用预读特性，相邻的节点也能够被预先载入。  
而如果把d值趋向于很大，则此时会变成一个数组，相当于hash，如果只是选取一个数据且内存足够一次性存放所有数据的时候且是hash更优，但是在实际业务场景上我们每次都不是但只选取一个数据且内存都不能满足一次性存放所有数据。  
因此,MySQL使用B+ Tree的的优点是可以一次选取多个数据且分批载入数据。

# MYSQL的两种存储引擎区别（事务、锁级别等等），各自的适用场景 
MYISAM 不支持事务，不支持外键，表锁，插入数据时，锁定整个表，查表总行数时，不需要全表扫描   
INNODB 支持事务，支持外键，行锁，查表总行数时，全表扫描  

# InnoDB索引和MyISAM索引的区别
一是主索引的区别，InnoDB的数据文件本身就是索引文件。而MyISAM的索引和数据是分开的。   
二是辅助索引的区别：InnoDB的辅助索引data域存储相应记录主键的值而不是地址。而MyISAM的辅助索引和主索引没有多大区别。  


# 索引有B+索引和hash索引，各自的区别
hash索引，等值查询效率高,不能排序,不能进行范围查询

B+索引,数据有序, 范围查询

# B+索引数据结构，和B树的区别
1.单一节点存储更多的元素，B+树空间利用率更高，使得查询的IO次数更少  
2.所有查询都要查找叶子节点，查询性能稳定  
3.所有叶子节点形成有序链表，便于范围查询  

# 聚集索引和非聚集索引的区别
聚集索引：数据按索引顺序存储，中子节点存储真实的物理数据  
非聚集索引：存储指向真正数据行的指针

# 索引的优缺点，什么时候使用索引，什么时候不能使用索引
1.索引最大的好处是提高查询速度  
2.缺点是更新数据时效性低，因为要同时更新索引  
3.对数据进行频繁查询建议建立索引，如果要频繁更改数据不建议使用索引  

